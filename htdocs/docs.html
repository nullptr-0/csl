<html>
  <head>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/vditor/dist/index.css" />
    <script src="https://unpkg.com/vditor/dist/method.min.js"></script>
    <style>
      :root {
        --primary-color: #2b6cb0;
        --secondary-color: #4a5568;
        --code-bg: #f7fafc;
        --border-color: #e2e8f0;
      }

      body {
        font-family: system-ui, -apple-system, sans-serif;
        line-height: 1.6;
        color: var(--secondary-color);
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
        background: #f8fafc;
      }

      h1, h2, h3 {
        color: var(--primary-color);
        margin: 2rem 0 1rem;
        font-weight: 600;
      }

      h1 {
        font-size: 2.5rem;
        border-bottom: 3px solid var(--border-color);
        padding-bottom: 1rem;
      }

      .vditor-reset {
        background: white;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin: 1.5rem 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
      }

      th, td {
        padding: 0.75rem;
        text-align: left;
        border-bottom: 1px solid var(--border-color);
      }

      th {
        background: var(--primary-color);
        color: white;
        font-weight: 500;
      }

      tr:nth-child(even) {
        background-color: #f8fafc;
      }

      .warning {
        background: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 1rem;
        margin: 1.5rem 0;
        border-radius: 4px;
      }

      .toc {
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        margin: 2rem 0;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }

      .toc ul {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }

      .toc a {
        color: var(--secondary-color);
        text-decoration: none;
        padding: 0.5rem;
        display: block;
        border-radius: 4px;
        transition: all 0.2s;
      }

      .toc a:hover {
        background: var(--code-bg);
        color: var(--primary-color);
      }

      @media (max-width: 768px) {
        body {
          padding: 1rem;
        }
        
        .vditor-reset {
          padding: 1rem;
        }
        
        h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="toc">
      <h3>Table of Contents</h3>
      <ul>
        <li><a href="#example">CSL Example</a></li>
        <li><a href="#features">Key Features</a></li>
        <li><a href="#semantics">Semantic Rules</a></li>
        <li><a href="#scoping">Scoping Rules</a></li>
        <li><a href="#subset"><code>subset</code> Key Rules</a></li>
        <li><a href="#tooling">Tooling Integration</a></li>
        <li><a href="#why">Why CSL Works</a></li>
      </ul>
    </div>
    <div class="vditor-reset" id="preview">
      <h1><strong>Config Schema Language (CSL)</strong></h1>
      <p>
        <strong>Config Schema Language (CSL)</strong> is a language that
        describes the schema of a configuration. It combines readability with
        formal structure. The syntax takes inspiration from TypeScript, C++ and
        Rust, using familiar braces and type annotations while adding
        declarative constraints.
      </p>
      <hr />
      <h3 id="example"><strong>Config Schema Language (CSL) Example</strong></h3>
      <pre><code class="language-CSL">// Root configuration structure
config MyAppConfig {
  // Basic key-value pairs (mandatory by default)
  app_name: string;
  version: string;
  environment: &quot;dev&quot; | &quot;staging&quot; | &quot;prod&quot; = &quot;dev&quot;; // Optional default value

  // Optional key (denoted by '?')
  timeout?: number @min(0) @max(60); // Annotations for validation

  // Nested table
  database: {
    host: string;
    port: number @range(1024, 65535);
    credentials?: { // Optional sub-table
      username: string;
      password: string;
    };
  };

  // Array of objects
  endpoints: {
    path: string;
    method: &quot;GET&quot; | &quot;POST&quot; | &quot;PUT&quot;;
    rate_limit?: number;
  }[];

  // Unspecified table/array
  metadata?: any{};
  debug_flags?: any[];

  // Nested table with optional unspecified content
  services: {
    name: string;
    config?: any{}; // Any subtable allowed
  }[];

  // Array of unspecified tables
  raw_data?: any{}[];

  // Key relationships &amp; constraints
  constraints {
    // Conflicts: 'ssl' cannot coexist with 'insecure_mode'
    conflicts database.ssl with insecure_mode;

    // Dependency: If 'credentials' exists, 'environment' must be &quot;prod&quot;
    requires database.credentials =&gt; environment == &quot;prod&quot;;

    // Custom validation: If 'environment' is &quot;prod&quot;, 'timeout' must be &gt; 10
    validate environment == &quot;prod&quot; ? timeout &gt; 10 : true;

    // Conflicts: &quot;debug_flags&quot; cannot coexist with &quot;production_mode&quot;
    conflicts debug_flags with production_mode;

    // Dependency: If &quot;metadata&quot; exists, &quot;version&quot; must exist (no value check)
    requires metadata =&gt; version;

    // Mixed dependency: If &quot;services&quot; has entries, &quot;app_name&quot; must match a regex
    requires services =&gt; app_name @regex(&quot;^svc-.*&quot;);
  };
}
</code></pre>
      <hr />
      <h3 id="features"><strong>Key Features</strong></h3>
      <ol>
        <li>
          <p><strong>Token Format</strong></p>
          <ul>
            <li>
              <p>
                <strong>Comments</strong>:
                <code>//</code> marks the rest of the line as a comment, except when inside a string.
              </p>
            </li>
            <li>
              <p>
                <strong>Numbers</strong>: Decimal numbers (e.g.,
                <code>123</code>, <code>3.14</code> and <code>1e5</code>),
                binary numbers (start with <code>0b</code>), octal numbers
                (start with <code>0o</code>), hexadecimal numbers (start with
                <code>0x</code>) and special numbers (<code>nan</code>,
                <code>+nan</code>, <code>-nan</code>, <code>inf</code>,
                <code>+inf</code> and <code>-inf</code>). Use a
                <code>_</code> to enhance readability (e.g.,
                <code>1_000_000</code>).
              </p>
            </li>
            <li>
              <p>
                <strong>Booleans</strong>: <code>true</code>/<code>false</code>.
              </p>
            </li>
            <li>
              <p>
                <strong>Strings</strong>: Normal string literals
                (<code>&quot;...&quot;</code>, where escape sequences are
                allowed) and raw string literals
                (<code>R&quot;delim(...)delim&quot;</code>, where the delimiter
                matches
                <code
                  >[a-zA-Z0-9!\&quot;#%&amp;'*+,\-.\/:;&lt;=&gt;?\[\]^_{|}~]{0,16}</code
                >). The valid escape sequences in normal strings are:
              </p>
              <table>
                <thead>
                  <tr>
                    <th>Escape Sequence</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><code>\a</code></td>
                    <td><code>\x07</code> alert (bell)</td>
                  </tr>
                  <tr>
                    <td><code>\b</code></td>
                    <td><code>\x08</code> backspace</td>
                  </tr>
                  <tr>
                    <td><code>\t</code></td>
                    <td><code>\x09</code> horizonal tab</td>
                  </tr>
                  <tr>
                    <td><code>\n</code></td>
                    <td><code>\x0A</code> newline (or line feed)</td>
                  </tr>
                  <tr>
                    <td><code>\v</code></td>
                    <td><code>\x0B</code> vertical tab</td>
                  </tr>
                  <tr>
                    <td><code>\f</code></td>
                    <td><code>\x0C</code> form feed</td>
                  </tr>
                  <tr>
                    <td><code>\r</code></td>
                    <td><code>\x0D</code> carriage return</td>
                  </tr>
                  <tr>
                    <td><code>\&quot;</code></td>
                    <td>quotation mark</td>
                  </tr>
                  <tr>
                    <td><code>\'</code></td>
                    <td>apostrophe</td>
                  </tr>
                  <tr>
                    <td><code>\?</code></td>
                    <td>question mark (used to avoid trigraphs)</td>
                  </tr>
                  <tr>
                    <td><code>\\</code></td>
                    <td>backslash</td>
                  </tr>
                  <tr>
                    <td><code>\`</code></td>
                    <td>backtick</td>
                  </tr>
                  <tr>
                    <td><code>\</code> + up to 3 octal digits</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>\x</code> + any number of hex digits</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td><code>\u</code> + 4 hex digits (Unicode BMP)</td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>
                      <code>\U</code> + 8 hex digits (Unicode astral planes)
                    </td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>any other invalid sequences</td>
                    <td>
                      content without <code>\</code> (e.g., <code>\c</code> is
                      interpreted as <code>c</code>)
                    </td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p><strong>Date-times</strong>: ISO 8601 data-times.</p>
            </li>
            <li>
              <p>
                <strong>Durations</strong>: ISO 8601 durations or the following
                shorthand format:
              </p>
              <table>
                <thead>
                  <tr>
                    <th>Unit</th>
                    <th>Suffix</th>
                    <th>Example</th>
                    <th>Notes</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>Year</td>
                    <td><code>y</code></td>
                    <td><code>1y</code></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>Month</td>
                    <td><code>mo</code></td>
                    <td><code>6mo</code></td>
                    <td>Avoids conflict with <code>m</code> (minute).</td>
                  </tr>
                  <tr>
                    <td>Week</td>
                    <td><code>w</code></td>
                    <td><code>2w</code></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>Day</td>
                    <td><code>d</code></td>
                    <td><code>3d</code></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>Hour</td>
                    <td><code>h</code></td>
                    <td><code>4h</code></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>Minute</td>
                    <td><code>m</code></td>
                    <td><code>30m</code></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>Second</td>
                    <td><code>s</code></td>
                    <td><code>15s</code></td>
                    <td></td>
                  </tr>
                  <tr>
                    <td>Millisecond</td>
                    <td><code>ms</code></td>
                    <td><code>200ms</code></td>
                    <td></td>
                  </tr>
                </tbody>
              </table>
            </li>
            <li>
              <p>
                <strong>Identifiers (Keys)</strong>:
                <code>[a-zA-Z_][a-zA-Z0-9_]*</code> or content enclosed in backticks (<code>`</code>) using the same rules as string literals.
              <pre><code class="language-CSL">key: number;
`quotedKey1`: number;
R`delim(quotedKey2)delim`: number;
</code></pre>
              </p>
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Type System</strong></p>
          <ul>
            <li>
              <p>
                <strong>Primitives</strong>: <code>string</code>,
                <code>number</code>, <code>boolean</code>,
                <code>datetime</code>, <code>duration</code>.
              </p>
            </li>
            <li>
              <p>
                <strong>Enums</strong>:
                <code>&quot;GET&quot; | &quot;POST&quot;</code> (union of
                literals).
              </p>
            </li>
            <li>
              <p>
                <strong>Tables</strong>:
                <code>{ key: type; ... }</code> (nestable objects).
              </p>
            </li>
            <li>
              <p>
                <strong>Arrays</strong>: <code>type[]</code> (e.g.,
                <code>string[]</code>, <code>{...}[]</code>).
              </p>
            </li>
            <li>
              <p>
                <strong>Union Type</strong>:<br />
                Use the | operator to allow multiple types or literals.
              </p>
              <pre><code class="language-CSL">port: number | string;  // Number or string
debug: boolean | &quot;verbose&quot;; // Boolean or the literal &quot;verbose&quot;
</code></pre>
              <p>
                Specifying a type that a literal in the union has is not
                allowed.
              </p>
              <pre><code class="language-CSL">config Example {
  // ❌ Invalid: &quot;info&quot; is a string literal
  log_level: string | &quot;info&quot;;
}
</code></pre>
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Optionality</strong></p>
          <ul>
            <li>Mandatory keys: <code>key: type;</code></li>
            <li>Optional keys: <code>key?: type;</code></li>
          </ul>
        </li>
        <li>
          <p><strong>Annotations</strong> (Inline Validation)</p>
          <ul>
            <li>
              There are two types of annotations: local annotations and global
              annotations.
            </li>
            <li>
              Local annotations:
              <ul>
                <li>
                  Local annotations only apply to a primitive type or an
                  expression.
                </li>
                <li>
                  <code>@min(10)</code>, <code>@max(100)</code> – Numeric
                  bounds. Applies only to number type.
                </li>
                <li>
                  <code>@range(10, 100)</code> – Numeric range. Applies only to
                  number type.
                </li>
                <li>
                  <code>@int</code>, <code>@float</code> – Numeric type. Applies
                  only to number type.
                </li>
                <li>
                  <code>@regex(&quot;^[a-z]+$&quot;)</code> – Regex for strings.
                  Applies only to strings type.
                </li>
                <li>
                  <code>@start_with(&quot;/usr/&quot;)</code> – Starts-with
                  assertion for strings. Applies only to strings type.
                </li>
                <li>
                  <code>@end_with(&quot;.csl&quot;)</code> – Ends-with assertion
                  for strings. Applies only to strings type.
                </li>
                <li>
                  <code>@contain(&quot;temp&quot;)</code> – Contains assertion
                  for strings. Applies only to strings type.
                </li>
                <li>
                  <code>@min_length(10)</code>, <code>@max_length(100)</code>,
                  <code>@length(50)</code> – String length assertion. Applies
                  only to strings type.
                </li>
                <li>
                  <code>@format(email)</code> – Built-in formats. Applies only
                  to strings type. Available formats:
                  <ul>
                    <li>
                      email:
                      <code
                        >(?:[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&amp;'*+/=?^_`{|}~-]+)*|&quot;(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21\x23-\x5b\x5d-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])*&quot;)@(?:(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\[(?:(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9]))\.){3}(?:(2(5[0-5]|[0-4][0-9])|1[0-9][0-9]|[1-9]?[0-9])|[a-z0-9-]*[a-z0-9]:(?:[\x01-\x08\x0b\x0c\x0e-\x1f\x21-\x5a\x53-\x7f]|\\[\x01-\x09\x0b\x0c\x0e-\x7f])+)\])</code
                      >
                    </li>
                    <li>
                      uuid:
                      <code
                        >([0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12})</code
                      >
                    </li>
                    <li>
                      ipv4:
                      <code
                        >(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\.(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])</code
                      >
                    </li>
                    <li>
                      ipv6:
                      <code
                        >(?:[0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,7}:|(?:[0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|(?:[0-9a-fA-F]{1,4}:){1,5}(?::[0-9a-fA-F]{1,4}){1,2}|(?:[0-9a-fA-F]{1,4}:){1,4}(?::[0-9a-fA-F]{1,4}){1,3}|(?:[0-9a-fA-F]{1,4}:){1,3}(?::[0-9a-fA-F]{1,4}){1,4}|(?:[0-9a-fA-F]{1,4}:){1,2}(?::[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:(?::[0-9a-fA-F]{1,4}){1,6}|:((?::[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(?::[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]+|::(ffff(:0{1,4}){0,1}:){0,1}(25[0-5]|(2[0-4][0-9]|(1[01][0-9]|[1-9]?[0-9]))\.){3}(25[0-5]|(2[0-4][0-9]|(1[01][0-9]|[1-9]?[0-9])))</code
                      >
                    </li>
                    <li>
                      url:
                      <code
                        >(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?((?:(?!-)[A-Za-z0-9-]{0,62}[A-Za-z0-9]\.)+[A-Za-z]{2,6}|(?:\d{1,3}\.){3}\d{1,3})(?::\d{2,5})?(?:\/[^\s?#]*)?(?:\?[^\s#]*)?(?:#[^\s]*)?</code
                      >
                    </li>
                    <li>
                      phone:
                      <code
                        >\+?[0-9]{1,4}?[-. ]?\(?[0-9]{1,4}?\)?[-. ]?[0-9]{1,4}[-. ]?[0-9]{1,9}</code
                      >
                    </li>
                  </ul>
                </li>
              </ul>
            </li>
            <li>
              Global annotations:
              <ul>
                <li>Global annotations apply to the key.</li>
                <li>
                  <code>@deprecated(&quot;This key is deprecated.&quot;)</code>
                  – Marks a key as deprecated. This annotation always evaluates
                  to true.
                </li>
              </ul>
            </li>
            <li>
              Local annotations follow the specific type they apply to, while
              global annotations are placed at the end of the key declaration.
              <pre><code class="language-CSL">retries: &quot;unlimited&quot; | number @min(0) @deprecated(&quot;This key is deprecated.&quot;);
</code></pre>
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Constraints Block</strong></p>
          <ul>
            <li>
              <strong>Conflicts</strong>:
              <code>conflicts &lt;key&gt; with &lt;key&gt;;</code>
            </li>
            <li>
              <strong>Dependencies</strong>:
              <code>requires &lt;key&gt; =&gt; &lt;condition&gt;;</code>
            </li>
            <li>
              <strong>Custom Logic</strong>:
              <code>validate &lt;expression&gt;;</code> (boolean logic).
            </li>
            <li>
              Constraints block can appear anywhere in the scope, but only one
              per scope.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Expressions</strong></p>
          <ul>
            <li>
              Reference keys: <code>environment == &quot;prod&quot;</code>,
              <code>database.port &gt; 1024</code>.
            </li>
            <li>
              Comparison operators: <code>==</code>, <code>!=</code>,
              <code>&lt;</code>, <code>&gt;</code>, <code>&lt;=</code>,
              <code>&gt;=</code>.
            </li>
            <li>
              Logical operators (from highest priority to lowest priority):
              <code>!</code>, <code>&amp;&amp;</code>, <code>||</code>.
            </li>
            <li>Ternary operator: <code>? :</code>.</li>
          </ul>
        </li>
        <li>
          <p><strong>Unspecified Tables/Arrays</strong></p>
          <ul>
            <li>
              To allow a key to be <strong>any table</strong> or
              <strong>any array</strong> (without specifying internal
              structure):
            </li>
            <li>
              <strong>Any Table</strong>: Use <code>any{}</code> as the type.
              Accepts any table value (treated as a generic key-value table).
            </li>
            <li>
              <strong>Any Array</strong>: Use <code>any[]</code> as the type.
              Accepts any array (elements can be mixed types).
            </li>
            <li>
              Useful for &quot;passthrough&quot; configurations or avoiding
              over-constraining.
            </li>
            <li>
              <strong>Flexibility vs. Safety</strong>: <code>any{}</code>/<code
                >any[]</code
              >
              sacrifices validation for flexibility. Use sparingly.
            </li>
            <li>
              <strong>Tooling Support</strong>: Linters/IDEs should warn about
              unconstrained <code>any{}</code> usage.
            </li>
            <li>
              <code>any{}</code>/<code>any[]</code> cannot have nested
              constraints/annotations. They are &quot;opaque&quot; types.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Dependency Syntax</strong></p>
          <ul>
            <li>
              <code>requires key_A =&gt; key_B</code>: Ensures
              <strong>existence</strong> of <code>key_B</code> (not value of
              <code>key_B</code> being positive) if <code>key_A</code> exists
              (not value of <code>key_A</code> being positive).
            </li>
            <li>
              Combine with annotations for value-based constraints:
              <pre><code class="language-CSL">requires ssl =&gt; domain @regex(&quot;\\.example\\.com$&quot;);
</code></pre>
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Explicit Existence Checks</strong></p>
          <ul>
            <li>
              Use <code>exists(key)</code> in expressions for custom logic:
              <pre><code class="language-CSL">validate exists(database.credentials) ? environment == &quot;prod&quot; : true;
</code></pre>
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Wildcard Key (<code>*</code>)</strong>:</p>
        </li>
      </ol>
      <ul>
        <li>
          <p>Indicates &quot;any key name is allowed here.&quot;</p>
        </li>
        <li>
          <p>
            The value type after <code>:</code> enforces the structure for
            <strong>all matched entries</strong> in the table.
          </p>
        </li>
        <li>
          <p>
            A wildcard key matches any keys unless they are explicitly defined.
            Explicit keys take precedence over wildcards.
          </p>
          <pre><code class="language-CSL">config BuildConfig {
  // All keys under &quot;target&quot; must have values of type `{ lib_path: string; bin_path: string }`
  target: {
    x86: { lib_path: string; }; // Explicit key
    *: { lib_path: string; bin_path: string; }; // Wildcard
  };
}
</code></pre>
          <p>This means:</p>
          <ul>
            <li>
              <code>target</code> is a table where
              <strong>any key</strong> (e.g., <code>riscv</code>,
              <code>arm</code>, etc.) is allowed.
            </li>
            <li>
              <code>target.x86</code> <strong>only</strong> requires
              <code>lib_path</code> (wildcard <code>bin_path</code> is ignored
              for this key).
            </li>
            <li>
              Any other key (e.g., <code>arm</code>) <strong>must</strong> be a
              table with <code>lib_path</code> and <code>bin_path</code> (both
              strings).
            </li>
          </ul>
        </li>
        <li>
          <p>Wildcard keys works with nested structures. For example:</p>
          <pre><code class="language-CSL">platforms: {
  *: {  // Dynamic platform names (e.g., &quot;windows&quot;, &quot;linux&quot;)
    arch: {
      *: { lib_path: string; };  // Dynamic arch keys (e.g., &quot;x86&quot;, &quot;arm64&quot;)
    };
  };
};
</code></pre>
        </li>
        <li>
          <p>
            You can enforce additional rules on the dynamic keys or their values
            using a <code>constraints</code> block:
          </p>
          <pre><code class="language-CSL">config BuildConfig {
  target: {
    *: {
      lib_path: string @starts_with(&quot;/usr/&quot;);
      bin_path: string;
    };
  };

  constraints {
    // Require at least one key in &quot;target&quot;
    validate count_keys(target) &gt; 0;

    // All target keys must match a regex (e.g., lowercase/numbers)
    validate all_keys(target) match &quot;^[a-z0-9_]+$&quot;;
  };
}
</code></pre>
        </li>
      </ul>
      <ol start="11">
        <li><strong>Batch Key Validation</strong>:</li>
      </ol>
      <ul>
        <li>
          <code>count_keys(table)</code> – Returns the number of keys in a
          table.
        </li>
        <li>
          <code>all_keys(table)</code> – Returns the keys of a table for
          validation (e.g., regex checks).
        </li>
        <li>
          <code>wildcard_keys(table)</code> – Returns the wildcard keys of a
          table for validation (e.g., regex checks).
        </li>
        <li>
          Annotaions for string can be used with <code>all_keys</code> and
          <code>wildcard_keys</code> to validate the name of the keys.
        </li>
      </ul>
      <ol start="12">
        <li>
          <strong>Subset Validation</strong><br />
          Use <code>subset</code> function in the
          <code>constraints</code> block:
        </li>
      </ol>
      <pre><code class="language-CSL">constraints {
  // Basic subset check (all elements of `selected` exist in `allowed`)
  validate subset(selected_features, allowed_features);

  // Optional: Specify comparison keys for objects (e.g., match by id)
  validate subset(selected_plugins, available_plugins, [id]);
}
</code></pre>
      <hr />
      <h3 id="semantics"><strong>Semantic Rules</strong></h3>
      <ul>
        <li>
          <strong>Scoping</strong>: Constraints apply to the current block
          (e.g., nested tables have their own <code>constraints</code>).
        </li>
        <li>
          <strong>Path References</strong>: Use dot notation
          (<code>database.credentials.username</code>) to reference nested keys.
        </li>
        <li>
          <strong>Default Values</strong>: Assign with
          <code>= value</code> (e.g.,
          <code>environment = &quot;dev&quot;</code>).
        </li>
      </ul>
      <hr />
      <h3 id="scoping"><strong>Scoping Rules</strong></h3>
      <ol>
        <li>
          <p>
            <strong
              >Constraints in a nested block can only reference keys within
              their immediate scope</strong
            >.
          </p>
          <ul>
            <li>
              No access to parent/ancestor keys. In a scope, only local keys or
              <strong>relative nested keys</strong> are allowed.
            </li>
            <li>
              All keys in constraints must exist
              <strong>within the same block</strong> where the
              <code>constraints</code> are defined.
            </li>
            <li>
              <strong>Tooling</strong>: A parser/validator would flag any
              reference to keys outside the current block’s scope.
            </li>
            <li>
              <strong>Valid: Local Constraints Only</strong>
              <pre><code class="language-CSL">config Server {
  database: {
    ssl: boolean;
    port: number;
    constraints {
      // ✅ Valid: `ssl` and `port` are in the same block
      conflicts ssl with port;
    };
  };
  insecure_mode: boolean;

  constraints {
    // ✅ Valid: Root constraints can reference root keys (`insecure_mode`)
    // and nested keys via their **absolute path** (`database.ssl`).
    // (Root is the only scope allowed to reference nested keys globally.)
    conflicts database.ssl with insecure_mode;
  };
}
</code></pre>
            </li>
            <li>
              <strong
                >Invalid: Nested Constraints Referencing Parent Keys</strong
              >
              <pre><code class="language-CSL">config Example {
  log_level: &quot;debug&quot; | &quot;info&quot;;
  logger: {
    format: string;
    constraints {
      // ❌ Invalid: `log_level` is in the parent scope
      conflicts format with log_level;
    };
  };
}
</code></pre>
            </li>
            <li>
              <strong>Local-Only Rules For Wildcard Keys</strong>: Constraints
              inside the <code>*</code> block apply to
              <strong>all instances</strong> of dynamic keys. For example:
              <pre><code class="language-CSL">target: {
  *: {
    lib_path: string;
    constraints {
      // Applies to every key under &quot;target&quot;:
      // If `lib_path` contains &quot;temp&quot;, `bin_path` must exist.
      validate lib_path @contains(&quot;temp&quot;) ? exists(bin_path) : true;
    };
  };
};
</code></pre>
            </li>
          </ul>
        </li>
        <li>
          <p>
            <strong
              >Parent constraints cannot be overridden by child
              constraints</strong
            >.
          </p>
          <ul>
            <li>
              <p>
                Constraints are <strong>additive</strong>: Parent and child
                constraints <em>both</em> apply.
              </p>
            </li>
            <li>
              <p>
                Conflicting constraints (e.g., a parent says <code>A</code> is
                required, a child says <code>A</code> is forbidden) will make
                both constraints invalid.
              </p>
            </li>
            <li>
              <p>
                Constraints are <strong>never overridden</strong> — they are
                cumulative. For example:
              </p>
              <pre><code class="language-CSL">config Example {
  constraints {
    requires nested.a =&gt; b;  // Parent rule
  };
  nested: {
    a?: boolean;
    constraints {
      requires a =&gt; c;  // Child rule (additive)
    };
  };
}
</code></pre>
              <p>
                If <code>nested.a</code> exists, <strong>both</strong>
                <code>b</code> (from root) and <code>c</code> (from nested) must
                exist.<br />
                If <code>nested.a</code> and <code>nested.c</code> exist but
                <code>b</code> doesn’t, validation <strong>fails</strong> due to
                the root constraint.
              </p>
            </li>
          </ul>
        </li>
      </ol>
      <hr />
      <h3 id="subset">
        <strong><code>subset</code> Key Rules</strong>
      </h3>
      <ol>
        <li>
          <p><strong>Primitive Arrays</strong> (strings, numbers, etc.):</p>
          <ul>
            <li>
              Omit the <code>properties</code> parameter. Uses strict equality
              (<code>&quot;auto&quot; === &quot;auto&quot;</code>).
            </li>
            <li>
              Example: <code>subset(selected_ports, allowed_ports)</code>.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Object Arrays</strong>:</p>
          <ul>
            <li>
              Use <code>properties</code> to specify which keys to compare
              (e.g., <code>[id]</code>).
            </li>
            <li>
              If omitted, validates by
              <strong>full object equality</strong> (rarely useful, so tools may
              warn).
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Composite Keys</strong>:</p>
          <ul>
            <li>
              Provide multiple properties (e.g., <code>[region, env]</code>).
              Both must match.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Edge Cases</strong>:</p>
          <ul>
            <li>Empty <code>source_array</code> is always valid.</li>
            <li>
              Empty <code>target_array</code> + non-empty
              <code>source_array</code> → invalid.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Tooling Behavior</strong></p>
          <ul>
            <li>
              <strong>Validation</strong>:
              <ul>
                <li>
                  Ensure <code>properties</code> exist in both
                  <code>source_array</code> and
                  <code>target_array</code> schemas.
                </li>
                <li>
                  Error if <code>properties</code> are specified for primitive
                  arrays.
                </li>
              </ul>
            </li>
            <li>
              <strong>Autocomplete</strong>: Suggest available properties for
              object arrays.
            </li>
          </ul>
        </li>
      </ol>
      <hr />
      <h3 id="tooling"><strong>Tooling Integration</strong></h3>
      <ul>
        <li>
          <strong>Validation</strong>: Use a CSL parser to check config files
          against the schema.
        </li>
        <li>
          <strong>Autocomplete</strong>: IDEs can suggest keys/types based on
          the schema.
        </li>
        <li>
          <strong>Documentation</strong>: Generate human-readable docs from CSL
          files.
        </li>
      </ul>
      <hr />
      <h3 id="why"><strong>Why CSL Works</strong></h3>
      <p>
        <strong>CSL</strong> strikes a deliberate balance between flexibility
        and rigor, making it effective for real-world configuration management:
      </p>
      <ol>
        <li>
          <p><strong>Human-Centered Design</strong></p>
          <ul>
            <li>
              <strong>Familiar syntax</strong> (TypeScript/C++/Rust-inspired)
              reduces cognitive load. Developers intuitively understand braces,
              type annotations, and <code>key: value</code> structures.
            </li>
            <li>
              <strong>Annotations</strong> keep validation rules inline with
              type definitions, minimizing context switching.
            </li>
            <li>
              <strong>Wildcard keys</strong> (<code>*</code>) and
              <code>any{}</code>/<code>any[]</code> enable gradual schema
              adoption—teams can start loosely and tighten constraints
              incrementally.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Precision Without Verbosity</strong></p>
          <ul>
            <li>
              <strong>Union types</strong> (<code
                >&quot;dev&quot; | &quot;prod&quot;</code
              >) and <strong>enums</strong> enforce strict allowed values
              without bloated boilerplate.
            </li>
            <li>
              <strong>Expressive constraints</strong> (e.g.,
              <code>conflicts</code>, <code>requires</code>) declaratively model
              complex key relationships, replacing fragile ad-hoc validation
              scripts.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Context-Aware Validation</strong></p>
          <ul>
            <li>
              <strong>Scoped constraints</strong> ensure rules apply only to
              their logical context, preventing unintended side effects.
            </li>
            <li>
              <strong>Absolute/relative paths</strong>
              (<code>database.port</code>) enable cross-key validation while
              nested constraints keep local logic self-contained.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Dynamic Config Support</strong></p>
          <ul>
            <li>
              <strong>Wildcard-driven schemas</strong> validate dynamic keys
              (e.g., environment-specific settings) without sacrificing
              structure.
            </li>
            <li>
              <strong>Batch key checks</strong> (<code>all_keys()</code>, regex
              validations) enforce naming conventions or key patterns at scale.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Tooling-Ready Structure</strong></p>
          <ul>
            <li>
              <strong>Explicit types and constraints</strong> enable IDE
              autocomplete, linting, and documentation generation
              out-of-the-box.
            </li>
            <li>
              <strong><code>subset</code> validation</strong> and
              <strong>existence checks</strong> (<code>exists()</code>) cover
              advanced use cases like feature toggles or plugin dependencies.
            </li>
          </ul>
        </li>
        <li>
          <p><strong>Safety by Default</strong></p>
          <ul>
            <li>
              <strong>Mandatory keys</strong> enforce critical properties
              upfront.
            </li>
            <li>
              <strong>Conflict resolution</strong> (<code
                >conflicts X with Y</code
              >) prevents invalid states that manual reviews often miss.
            </li>
          </ul>
        </li>
      </ol>
      <p>
        <strong>CSL</strong> avoids the extremes of rigid, unmaintainable
        schemas or overly permissive &quot;anything goes&quot; configurations.
        It codifies best practices—type safety, proactive validation, and clear
        relationships—while staying adaptable to evolving requirements.
      </p>
    </div>
    <script>
      // Add smooth scrolling
      document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
          e.preventDefault();
          document.querySelector(this.getAttribute('href')).scrollIntoView({
            behavior: 'smooth'
          });
        });
      });
    </script>
    <script>
      const previewElement = document.getElementById("preview");
      Vditor.setContentTheme(
        "light",
        "https://unpkg.com/vditor/dist/css/content-theme"
      );
      Vditor.codeRender(previewElement);
      Vditor.highlightRender(
        { enable: true, lineNumber: true, defaultLang: "", style: "github" },
        previewElement,
        "https://unpkg.com/vditor"
      );
      Vditor.mathRender(previewElement, {
        cdn: "https://unpkg.com/vditor",
        math: { engine: "KaTeX", inlineDigit: false, macros: {} },
      });
      Vditor.mermaidRender(
        previewElement,
        "https://unpkg.com/vditor",
        "classic"
      );
      Vditor.markmapRender(
        previewElement,
        "https://unpkg.com/vditor",
        "classic"
      );
      Vditor.flowchartRender(previewElement, "https://unpkg.com/vditor");
      Vditor.graphvizRender(previewElement, "https://unpkg.com/vditor");
      Vditor.chartRender(previewElement, "https://unpkg.com/vditor", "classic");
      Vditor.mindmapRender(
        previewElement,
        "https://unpkg.com/vditor",
        "classic"
      );
      Vditor.abcRender(previewElement, "https://unpkg.com/vditor");
      Vditor.mediaRender(previewElement);
      Vditor.speechRender(previewElement);
    </script>
    <script src="https://unpkg.com/vditor/dist/js/icons/ant.js"></script>
  </body>
</html>
